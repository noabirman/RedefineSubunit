# RedefineSubunit: Alternative Subunit Definition for CombFold

This repository provides an alternative way to insert protein complexes into [CombFold](https://github.com/dina-lab3D/CombFold), not just as individual chains but as **subunits defined by high-confidence structural regions**.  

It takes AlphaFold models outputs (mmCIF/PDB files + confidence JSON) and:
1. **Splits chains into subunits** using plDDT thresholds and gaps.
2. **Builds graphs** where subunits are nodes and edges reflect inter-subunit PAE interactions.
3. **Merges overlapping subunits** across models into final `subunits_info.json` for CombFold.

---

## Installation  

Clone the repository and install dependencies:

```bash
git clone https://github.com/username/RedefineSubunit.git
cd RedefineSubunit
pip install -r requirements.txt
```

Dependencies include:
- `biopython` for structure parsing
- `networkx` for graph construction
- `numpy` for matrix handling

---

## Usage
### 1. Prepare input data
To run **RedefineSubunit**, each complex folder should include the following:
#### 1.1 AlphaFold models
- `*_model.cif` - AlphaFold predicted structure of the complex in CIF format. 
  Example: `7pkn_model.cif`
- `*_confidences.json` - JSON file containing:
  - `plDDT` values per residue 
  - `PAE` matrices 
  - Chain IDs 
    Example: `7pkn_confidences.json`
These files are typically generated by AlphaFold or AlphaFold-Multimer.
#### 1.2 Subunit information
- `subunits_info.json` - Original chain-based subunit definitions. Each chain in the complex should be listed with its start/end residues and chain ID. 
- `chain_id_mapping.json` - Mapping from chain names in your MSA/AF input to internal chain IDs.
Example:
```
{
    "A": {
        "chain_id": "H",
        "start": 1,
        "end": 247
    },
    "B": {
        "chain_id": "I",
        "start": 1,
        "end": 756
    },...
 }
```

### 2. Generate subunit graphs
From a folder with multiple AlphaFold predictions:

```
python create_graph_from_complex.py <af_pairs_folder_path> [subunits_info_path] [chain_id_mapping_path]
```
Where:
- `<af_folder_path>` - Folder containing **AlphaFold predictions for all pairs of chains in the complex**.
Each pair should include:
  - `*_model.cif` - Structure of the chain pair
  - `*_confidences.json` - Corresponding confidence data (plDDT, PAE, chain IDs)
- `[subunits_info_path]` - Optional. Path to `subunits_info.json`. Defaults to `subunits_info.json` in the parent folder of `<af_folder_path>`.
- `[chain_id_mapping_path]` - Optional. Path to `chain_id_mapping.json`. Defaults to `chain_id_mapping.json` in the parent folder of `<af_folder_path>`.

This will:
- Build subunit graphs for each prediction (`create_graph_from_af_model.py`)
- Merge overlapping subunits across all predictions 
- Produce a new `combfold/subunits_info.json` with high/low confidence segments

### 3. Visualize the final graph

After merging, the script will show a circular graph of subunits using `show_circle`.

---
## Repository Structure
```
RedefineSubunit/
│── create_graph_from_af_model.py   # Splits AF model into redefined subunits & builds graphs
│── create_graph_from_complex.py    # Merges graphs from diffrent models, saves final subunit info
│── results_analysis/               # Complex analysis, how the tool behave on our data, tm-score calculation, comparision between orignal subunit info and Redefined
│── preprocess/                     # Code for running MSA and AF3
│── combfold/                       # Code for running CombFold on our redefined subunits
│── requirements.txt                # Dependencies
│── README.md                       # Documentation
```
---
## Output
- Redefined subunits JSON (`combfold/subunits_info.json`)
- Graph visualizations of the complex's subunits and interactions
---

## Reference

If you use this pipeline, please cite:

**CombFold: predicting structures of large protein assemblies using a combinatorial assembly algorithm and AlphaFold2**  
Ben Shor & Dina Schneidman-Duhovny  
https://www.nature.com/articles/s41592-024-02174-0

---

For more about CombFold, see the official repository:  
https://github.com/dina-lab3D/CombFold
